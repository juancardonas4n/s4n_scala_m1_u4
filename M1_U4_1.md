# Tipos de datos inmutables

Objetivos de la unidad de aprendizaje:

* El **estado mutable compartido** es un peligro.
* Los **estados mutables compartidos** se puede evitar de dos formas:
  * Técnica orientada a objetos: **Encapsulamiento** y **copia de valores**.
  * Técnica funcional: **Tipos de datos inmutables**
* La relación entre funciones puras y valores inmutables.

---

# Definición de programación funcional


> Programación funcional es programar con funciones puras que manipulan tipos de datos inmutables.

---
# Solución al problema del Sistema de control planes de visitas

* La siguiente es una primera solución de la función `crearNuevoPlan`:
```{.java}
List<String> crearNuevoPlan(List<String> planAnterior,
				   String nuevoCliente,
				   String clienteActual) {
	int indiceCliente = planAnterior.indexOf(clienteActual);
	planAnterior.add(indiceCliente, nuevoCliente);
	return planAnterior;
}

```

---
# Problemas con la implementación propuesta.

* La función no es pura: Cambia un valor anterior.
* Tenemos que mirar el cuerpo de la función no podemos confiar en ella.
* Lo que hace que este valor sea mutable.
* Evitar esta mutabilidad es el corazón de la programación funcional.

---

# Problema de mutabilidad (Estado compartido mutable)

* Un **estado**  es una única instancia de un valor que es almacenada en un lugar y puede ser accedida desde código.
* Si el estado es puede ser modificado es un **estado mutable**.
* Si estado mutable puede ser modificado entre diferentes partes del código es un **estado compartido mutable**.

---

# Problema de mutabilidad (Estado compartido mutable)

* La variable `List<String> planVisitasA`:
  * Es un *estado* por que puede ser accedido.
  * Es *mutable* por que la función `crearPlanNuevo` la modifica para poder el *nuevo plan*.
  * Es *compartida* puede ser modificada desde `crearPlanNuevo`.

---

# Problema de mutabilidad (Estado compartido mutable)

* El **estado compartido mutable** es bloque de construcción de la programación imperativa.
* Esta puede tomar diferentes formas:
  * Una variable global,
  * un campo en una clase,
  * cualquier almacenamiento de lectura escritura como una tabla de una base de datos o un fichero.

---

# Problemas que causa los **estados mutables compartidos** al programador

* Los **estados mutables compartidos** tienen las siguientes consecuencias:
  1. El programador debe observar cada **estado mutable compartido** como parte de la solución del problema.
  2. Cada **estado mutable compartido** tiene asociado un problema de propiedad y responsabilidad.
  3. Muchas entidades de nuestro programa pueden cambiar el estado, identificar todos los posibles valores.
* Los **estados mutables compartidos** son las partes móviles de nuestros problemas.


---

# Resolver el problema de la mutabilidad

* Dos técnicas: 
  1. Orientadas a Objeto.
  2. Funcional
* Orientadas a objeto están basadas en:
  * Encasulapmiento.
  * Copia.
* Funcional:
  * Tipos de datos inmutables.

---

# Resolver el problema de mutabilidad (Visión OOP)

* Esto se resuelve creando una copia de seguridad.
* Esta copia no modifica la original.
```{.java}
List<String> crearNuevoPlan(List<String> planAnterior,
				   String nuevoCliente,
				   String clienteActual) {
	int indiceCliente = planAnterior.indexOf(clienteActual);
	List<String> planNuevo = new ArrayList<>(planAnterior);
	planNuevo.add(indiceCliente, nuevoCliente);
	return planNuevo;
}
```
* La nueva copia es independiente de valor original.
* Si la copia es cambiada no se cambia el original.

